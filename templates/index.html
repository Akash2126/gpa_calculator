<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SRM University GPA Calculator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #1e1e1e; color: #f5f5f5; text-align: center; }
    table { margin: auto; border-collapse: collapse; width: 80%; }
    th, td { padding: 10px; border: 1px solid #444; }
    input { padding: 6px; border-radius: 4px; border: none; text-align: center; }
    button { margin: 15px; padding: 10px 20px; border: none; border-radius: 6px; background: teal; color: white; cursor: pointer; }
    h1 { color: #00e676; }
    footer { margin-top: 30px; font-size: 14px; color: #aaa; }
  </style>
</head>
<body>
  <h1>SRM University GPA Calculator</h1>

  <!-- Mode Selection -->
  <form method="POST">
    <label><input type="radio" name="mode" value="marks" checked onclick="switchMode('marks')"> Marks Based</label>
    <label><input type="radio" name="mode" value="grades" onclick="switchMode('grades')"> Grade Based</label>

    <table id="marksTable">
      <tr id="headerRow"><th>Subject</th><th>Credits</th><th id="inputHeader">Marks</th></tr>
      <tr>
        <td><input type="text" name="subject" placeholder="Subject"></td>
        <td><input type="number" name="credit" placeholder="Credits"></td>
        <td class="inputCol"><input type="number" name="value" placeholder="Marks"></td>
      </tr>
    </table>

    <button type="button" onclick="addRow()">Add Subject</button>
    <button type="submit">Calculate GPA</button>
  </form>

  {% if result %}
    <h2>ðŸ“˜ Grade Card ðŸ“˜</h2>
    <table>
      <tr><th>Subject</th><th>Credits</th><th>Grade</th><th>Grade Points</th></tr>
      {% for sub, c, g, gp in result.records %}
      <tr><td>{{ sub }}</td><td>{{ c }}</td><td>{{ g }}</td><td>{{ gp }}</td></tr>
      {% endfor %}
    </table>
    <h3>GPA: {{ result.gpa }}</h3>

    <!-- Bar Chart -->
    <h2>ðŸ“Š Performance Chart ðŸ“Š</h2>
    <canvas id="barChart" width="400" height="200"></canvas>
    <script>
      const ctx = document.getElementById('barChart');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: {{ result.subjects | safe }},
          datasets: [{
            label: 'Grade Points',
            data: {{ result.points | safe }},
            backgroundColor: '#00e676'
          }]
        },
        options: {
          scales: {
            y: { beginAtZero: true, max: 10 }
          }
        }
      });
    </script>
  {% endif %}

  <footer>
    ðŸš€ Developed by <b>Akash Kumar Tiwari</b><br>
    (MCA 2023â€“2025, SRM University)
  </footer>

  <script>
    function addRow() {
      let table = document.getElementById("marksTable");
      let row = table.insertRow(-1);
      row.innerHTML = `<td><input type="text" name="subject" placeholder="Subject"></td>
                       <td><input type="number" name="credit" placeholder="Credits"></td>
                       <td class="inputCol"><input type="${getInputType()}" name="value" placeholder="${getPlaceholder()}"></td>`;
    }

    function switchMode(mode) {
      document.getElementById("inputHeader").innerText = (mode === 'marks') ? "Marks" : "Grade";
      document.querySelectorAll(".inputCol input").forEach(inp => {
        inp.type = (mode === 'marks') ? "number" : "text";
        inp.placeholder = (mode === 'marks') ? "Marks" : "Grade (O,A+,A,B+...)";
      });
    }

    function getInputType() {
      let mode = document.querySelector('input[name="mode"]:checked').value;
      return (mode === 'marks') ? "number" : "text";
    }

    function getPlaceholder() {
      let mode = document.querySelector('input[name="mode"]:checked').value;
      return (mode === 'marks') ? "Marks" : "Grade (O,A+,A,B+...)";
    }
  </script>
</body>
</html>
